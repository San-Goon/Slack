"use strict";(self.webpackChunkdofront=self.webpackChunkdofront||[]).push([[256],{5256:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var l=n(2309),a=n(2545),o=n(8678),r=n(3564),s=n(7294),c=n(5977),i=n(2503),u=n(1574);const d=(0,u.Z)("div",{target:"efy3wlg2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),h=(0,u.Z)("header",{target:"efy3wlg1"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"});(0,u.Z)("div",{target:"efy3wlg0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"});var p=n(958),f=n(2951),g=n(9669),v=n.n(g),m=n(8667),w=n(9250),b=()=>{var e,t;const{workspace:n,channel:u}=(0,c.UO)(),{data:g}=(0,i.ZP)("/api/users",r.Z),[b,x,k]=(0,o.Z)(""),{data:Z,mutate:y,setSize:C}=(0,p.ZP)((e=>`/api/workspaces/${n}/channels/${u}/chats?perPage=20&page=${e+1}`),r.Z),{data:E}=(0,i.ZP)(`/api/workspaces/${n}/channels/${u}`,r.Z),{data:_}=(0,i.ZP)(g?`/api/workspaces/${n}/channels/${u}/members`:null,r.Z),[$]=(0,f.Z)(n),S=0===(null==Z||null===(e=Z[0])||void 0===e?void 0:e.length)||Z&&(null===(t=Z[Z.length-1])||void 0===t?void 0:t.length)<20||!1,T=(0,s.useRef)(null),[z,P]=(0,s.useState)(!1),B=(0,s.useCallback)((e=>{if(e.preventDefault(),console.log(b),null!=b&&b.trim()&&Z&&E){const e=b;y((t=>{var n;return null==t||t[0].unshift({id:((null===(n=Z[0][0])||void 0===n?void 0:n.id)||0)+1,content:e,UserId:g.id,User:g,ChannelId:E.id,Channel:E,createdAt:new Date}),t}),!1).then((()=>{var e;k(""),null===(e=T.current)||void 0===e||e.scrollToBottom()})),v().post(`/api/workspaces/${n}/channels/${u}/chats`,{content:b}).then((()=>{y()})).catch(console.error)}}),[b,Z,g,E,n,u]),I=(0,s.useCallback)((e=>{e.Channel.name===u&&e.UserId!==(null==g?void 0:g.id)&&y((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{var e;T.current&&T.current.getScrollHeight()<T.current.getClientHeight()+T.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=T.current)||void 0===e?void 0:e.getValues()),setTimeout((()=>{var e;null===(e=T.current)||void 0===e||e.scrollToBottom()}),50))}))}),[u,g]);(0,s.useEffect)((()=>(null==$||$.on("message",I),()=>{null==$||$.off("message",I)})),[$,I]),(0,s.useEffect)((()=>{var e;1===(null==Z?void 0:Z.length)&&(null===(e=T.current)||void 0===e||e.scrollToBottom())}),[Z]);const U=(0,s.useCallback)((()=>{P(!0)}),[]),j=(0,s.useCallback)((()=>{P(!1)}),[]);if(!g)return null;const N=(0,m.Z)(Z?Z.flat().reverse():[]);return s.createElement(d,null,s.createElement(h,null,s.createElement("span",null,"#",u),s.createElement("div",{className:"header-right"},s.createElement("span",null,null==_?void 0:_.length),s.createElement("button",{onClick:U,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip-parent",type:"button"},s.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),s.createElement(a.Z,{chatSections:N,ref:T,setSize:C,isReachingEnd:S}),s.createElement(l.Z,{chat:b,onChangeChat:x,onSubmitForm:B}),s.createElement(w.Z,{show:z,onCloseModal:j,setShowInviteChannelModal:P}))}}}]);