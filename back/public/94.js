"use strict";(self.webpackChunkfront=self.webpackChunkfront||[]).push([[94],{3094:function(e,t,n){n.r(t),n.d(t,{default:function(){return T}});var a=n(1574);const l=(0,a.Z)("div",{target:"e1wlp2eg2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),r=(0,a.Z)("header",{target:"e1wlp2eg1"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"});(0,a.Z)("div",{target:"e1wlp2eg0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"});var o=n(7294),s=n(6182),i=n.n(s),c=n(2503),u=n(958),d=n(3564),f=n(5977),g=n(2309),m=n(2545),p=n(8678),h=n(9669),v=n.n(h),w=n(8667),k=n(2951),x=n(9732),T=()=>{var e,t;const{workspace:n,id:a}=(0,f.UO)(),{data:s}=(0,c.ZP)(`/api/workspaces/${n}/users/${a}`,d.Z),{data:h}=(0,c.ZP)("/api/users",d.Z),[T,b,S]=(0,p.Z)(""),[Z,$]=(0,o.useState)(!1),{data:E,mutate:y,setSize:C}=(0,u.ZP)((e=>`/api/workspaces/${n}/dms/${a}/chats?perPage=20&page=${e+1}`),d.Z),[D]=(0,k.Z)(n),I=0===(null==E||null===(e=E[0])||void 0===e?void 0:e.length)||E&&(null===(t=E[E.length-1])||void 0===t?void 0:t.length)<20||!1,z=(0,o.useRef)(null),B=(0,o.useCallback)((e=>{if(e.preventDefault(),null!=T&&T.trim()&&E){const e=T;y((t=>{var n;return null==t||t[0].unshift({id:((null===(n=E[0][0])||void 0===n?void 0:n.id)||0)+1,content:e,SenderId:h.Id,Sender:h,ReceiverId:s.id,Receiver:s,createdAt:new Date}),t}),!1).then((()=>{var e;localStorage.setItem(`${n}-${a}`,(new Date).getTime().toString()),S(""),null===(e=z.current)||void 0===e||e.scrollToBottom()})),v().post(`/api/workspaces/${n}/dms/${a}/chats`,{content:T}).then((()=>{y()})).catch((e=>{console.dir(e)}))}}),[T,E,h,s,n,a]),P=(0,o.useCallback)((e=>{e.SenderId===Number(a)&&h.id!==Number(a)&&y((t=>(null==t||t[0].unshift(e),t)),!1).then((()=>{var e;z.current&&z.current.getScrollHeight()<z.current.getClientHeight()+z.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=z.current)||void 0===e?void 0:e.getValues()),setTimeout((()=>{var e;null===(e=z.current)||void 0===e||e.scrollToBottom()}),50))}))}),[]);(0,o.useEffect)((()=>{localStorage.setItem(`${n}-${a}`,(new Date).getTime().toString())}),[n,a]),(0,o.useEffect)((()=>(null==D||D.on("dm",P),()=>{null==D||D.off("dm",P)})),[D,P]),(0,o.useEffect)((()=>{1===(null==E?void 0:E.length)&&setTimeout((()=>{var e;null===(e=z.current)||void 0===e||e.scrollToBottom()}),50)}),[E]);const R=(0,o.useCallback)((e=>{console.log(e);const t=new FormData;if(e.dataTransfer.items){for(let n=0;n<e.dataTransfer.items.length;n++)if("file"===e.dataTransfer.items[n].kind){const a=e.dataTransfer.items[n].getAsFile();console.log("... file["+n+"].name ="+a.name),t.append("image",a)}}else for(let n=0;n<e.dataTransfer.files.length;n++)console.log("...file["+n+"].name="+e.dataTransfer.files[n].name),t.append("image",e.dataTransfer.files[n]);v().post(`/api/workspaces/${n}/dms/${a}/images`,t).then((()=>{$(!1)}))}),[n,a]),F=(0,o.useCallback)((e=>{e.preventDefault(),console.log(e),$(!0)}),[]);if(!s||!h)return null;const j=(0,w.Z)(E?E.flat().reverse():[]);return o.createElement(l,{onDrop:R,onDragOver:F},o.createElement(r,null,o.createElement("img",{src:i().url(s.email,{s:"24px",d:"retro"}),alt:s.nickname}),o.createElement("span",null,s.nickname)),o.createElement(m.Z,{chatSections:j,ref:z,setSize:C,isReachingEnd:I}),o.createElement(g.Z,{chat:T,onChangeChat:b,onSubmitForm:B}),Z&&o.createElement(x.KW,null,"업로드!"))}}}]);